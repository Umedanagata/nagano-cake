<div class="container">
  <div class="row">
    <div class="col-xs-10 col-offset-xs-1">
      <% if @cart_items.empty? %>
        <h3>カートは空です</h3>

      <% else %>
      <table class="table table-striped">
          <tr>
            <th><%= current_customer.family_name %>さんのショッピングカート</th>
            <th></th>
            <th></th>
            <th></th>
            <th><%= link_to "カートを空にする", destroy_item_path(@cart_items), method: :delete,
              class: "btn btn-danger" %></th>
          </tr>
          <tr>
            <th>商品名</th>
            <th>単価（税込）</th>
            <th>数量</th>
            <th></th>
            <th>小計</th>
          </tr>
          <% sum = 0 %>
          <% @cart_items.each do |cart_item| %>

          <tr>
            <td><%= attachment_image_tag cart_item.item, :image, :fill, 110, 70,
              fallback: "noimage.jpg" %>
              <%= cart_item.item.name %></td>
              <% price = (cart_item.item.price * 1.08).floor %>
            <td>¥<%= price %></td>

            <%= form_for cart_item, url: cart_item_path(cart_item) do |f| %>
            <td><%= f.select :quantity, [1,2,3,4,5,], default: params[:quantity] %></td>
            <td><%= f.submit "変更" %></td>
            <% end %>

            <% amount = (cart_item.quantity).to_i * price %>
            <td>¥<%= amount %></td>
            <td><%= link_to "削除する", cart_item_path(cart_item), method: :delete, class: "btn btn-warning" %></td>
          </tr>
          <% sum += amount %>
          <% end %>
          <tr>
            <th><%= link_to "買い物を続ける", items_path, class: "btn btn-default" %></th>
            <th></th>
            <th>合計金額</th>
            <th>¥<%= sum %></th>
            <th><p><%= link_to "情報入力に進む", new_order_path, class: "btn btn-info" %></p></th>
          </tr>
      </table>

      <% end %>
    </div>
  </div>
</div>
